addpath(genpath('C:/HMMall'))
pi=[
0.2 % Stanje C
0.8 % Stanje H
];
transmat0=[
0.5 0.5 % P(C|C) P(H|C)
0.4 0.6 % P(C|H) P(H|H)
];
obsmat0=[
0.5 0.4 0.1 % P(1|C) P(2|C) P(3|C)
0.2 0.4 0.4 % P(1|H) P(2|H) P(3|H)
];
data=[3 1 3];
if ~iscell(data)
data = num2cell(data, 2);
end
ncases = length(data);
loglik = 0;
errors = [];
for m=1:ncases (m=1?)
	obslik0 = multinomial_prob(data{m}, obsmat0);
	[alpha, beta, gamma, ll] = ...
	fwdback(prior0, transmat0, obslik0, 'scaled', 0);
	if ll==-inf
		errors = [errors m];
	end
	loglik = loglik + ll;
end
sum(alpha)
sum(beta(:,1).*prior0.*obslik0(:,1))
sum(alpha.*beta)
(alpha.*beta)/sum(alpha(:,end)) - gamma
function [loglik, errors] = dhmm_logprob(data, prior0, transmat0, obsmat0)
vpath = viterbi_path(prior0, transmat0, obslik0)
[ll, p] = dhmm_logprob_path(prior0, transmat0, obslik0, vpath)
cp=cumprod(p)
log(cp(end))
#za vise
mpath=[
1 1 1
1 1 2
1 2 1
1 2 2
2 1 1
2 1 2
2 2 1
2 2 2];
llm=zeros(8,1); % Stupac za log-izvjesnosti
for i=1:8,
[llm(i), p] = dhmm_logprob_path(prior0, transmat0, obslik0,
mpath(i,:));
end;
sum(exp(llm))
#!za vise

% Sortiraj puteve prema izvjesnosti osmatranja od najizvjesnijeg do
% najmanje izvjesnog
[sllm,illm]=sort(-llm);
% Kumulativno zbrojih izvjesnosti od samo jednog najizvjesnijeg
% puta, pa prva dva puta stanja po izvjesnosti, pa prva tri, ... i
% tako sve do sume izvjesnosti po svim mogucim putevima stanja
cumsum(exp(-sllm)) %do 0.028562

mpath(illm,:) %putanje

>> cumsum(exp(-sllm))/sum(exp(llm)) %???

T = 15; % duljina svakog niza
nex = 10; % broj opservacijskih nizova
data = dhmm_sample(prior0, transmat0, obsmat0, nex, T);

a0=transmat0; for i=1:100, a0=a0*transmat0; end; %transmat0^T

a0(1,:)*obsmat0*15 %ocekivan broj pojavljivanja izlaza

hm=hist(data',[1 2 3])

mean(hm')/T*15

% generiraj visestruki opservacijski niz:
T = 1500; % duljina svakog niza
nex = 10; % broj opservacijskih nizova
data_1500 = dhmm_sample(prior0, transmat0, obsmat0, nex, T);
% Prebroji simbole u svakoj sekvenci
hm_1500=hist(data_1500',[1 2 3]);
% Usporedi s ocekivanim ucestalostima
mean(hm_1500')/T*15

% generiraj visestruki opservacijski niz:F
T = 15; % duljina svakog niza
nex = 1000; % broj opservacijskih nizova
data_1000 = dhmm_sample(prior0, transmat0, obsmat0, nex, T);
% Prebroji simbole u svakoj sekvenci
hm_1000=hist(data_1000',[1 2 3]);
% Usporedi s ocekivanim ucestalostima
mean(hm_1000')/T*15

% Izracunaj u petlji log-izvjesnosti svakog niza
nex=size(data_1000,1); % Broj eksperimenata
llm=zeros(nex,1); % Stupac log-izvjesnosti
for i=1:nex,
llm(i)=dhmm_logprob(data_1000(i,:), prior0, transmat0, obsmat0);
end;

exp((max(llm)-min(llm)))



prior1 = normalise(rand(Q,1));
transmat1 = mk_stochastic(rand(Q,Q));
obsmat1 = mk_stochastic(rand(Q,O))

[LL, prior2, transmat2, obsmat2] = dhmm_em(data_1000, prior1, transmat1, obsmat1, 'max_iter', 10);